---
#  set_fact:
#    server_token:

- name: 'Create service directories'
  loop:
    - '{{ k3s_service_dir }}/log'
  file:
    path: '{{ item }}'
    state: 'directory'

- name: 'Template in runit service'
  vars:
    log_file: '/var/log/k3s'
  loop: '{{ k3s_service_files }}'
  template:
    src: '{{ item.file[1:] }}.j2'
    dest: '{{ item.file }}'
    mode: '{{ item.mode | default("0644") }}'

- name: 'Enable service'
  file:
    state: 'link'
    src: '{{ k3s_service_dir }}'
    dest: '/var/service/k3s'
...
# vim: set filetype=yaml
